Below is a complete **`DATA‑VIS.md`** documentation block followed by the **improved `build_data_for_vis.py`** (v0 .2).  
Both pieces are copy‑ready—drop them into the repo and commit.

---

## `DATA‑VIS.md` – Extra Aggregates for the Visual‑Analytics Canvas

### 1 Scope  
This file documents the three JSON artefacts generated by `build_data_for_vis.py`.  
They power the “Entry Lens” canvas (glyph‑matrix, skyline histogram, concordance ribbon) and **do not replace** the core SPA files (`entries.ndjson`, `index.json`, `graph.json`, `symbols.json`).

### 2 Artefact overview﻿

| File | Size (uncompressed) | Records | Purpose in UI |
|------|--------------------|---------|---------------|
| `glyphMatrix.json` | ≈ 32 kB | 619 rows | Sparse **glyph × lemma‑prefix** matrix for the heat‑map ❶ citeturn2file2 |
| `letterHistogram.json` | ≈ 5 kB | 26 letters | A‑Z counts per source for skyline small‑multiples ❹ citeturn2file1 |
| `lemmaGlossPairs.json` | ≈ 140 kB | 10 000 pairs (default clip) | Top Latin ↔ German pair counts for the concordance ribbon ❷ citeturn2file0 |

### 3 Schemas

#### 3·1 `glyphMatrix.json`

```jsonc
[
  { "glyph": "alum", "bucket": "ab", "count": 1 },
  …
]
```

| Field | Type | Meaning |
|-------|------|---------|
| `glyph` | string | id from `symbols.json.id` |
| `bucket` | string | first two letters of `lemma_norm` (lower‑case) |
| `count` | int | number of occurrences of that glyph in lemmas of that bucket |

#### 3·2 `letterHistogram.json`

```jsonc
[
  { "letter": "a", "ruland": 524, "sommerhoff": 1452 },
  …
]
```

| Field | Type | Meaning |
|-------|------|---------|
| `letter` | `"a"`–`"z"` | first letter of `lemma_norm` |
| `ruland` | int | Ruland‑only entries beginning with this letter |
| `sommerhoff` | int | Sommerhoff‑only entries beginning with this letter |

*(Entries whose headword starts with a digit or special sign are excluded.)*

#### 3·3 `lemmaGlossPairs.json`

```jsonc
[
  { "latin": "lapides", "german": "ein", "count": 40 },
  …
]
```

| Field | Type | Meaning |
|-------|------|---------|
| `latin` | string | normalised Latin lemma |
| `german` | string | German token (whitespace‑split) |
| `count` | int | co‑occurrence frequency in any entry |

### 4 Front‑end loading pattern

```js
const [glyphMx, hist, pairs] = await Promise.all([
  fetch("/data/glyphMatrix.json").then(r => r.json()),
  fetch("/data/letterHistogram.json").then(r => r.json()),
  fetch("/data/lemmaGlossPairs.json").then(r => r.json())
]);
SelectionStore.setState({ glyphMx, hist, pairs });
```

### 5 Regeneration

```bash
# after running the main build
python scripts/build_data_for_vis.py             \
       --tei-dir data                            \
       --out-dir public/data                     \
       --pair-limit 12000   # optional larger cut
```